<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>ECG Display v.dev</title>

		<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

		<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
		<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
		
		<!-- Don't use this in production: -->
		<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

		<!-- D3.js for Scatter Plot -->
		<script src="https://d3js.org/d3.v7.min.js"></script>
	</head>
	<body>
		<div id="root"></div>
		<div id="graph">
		</div>
		<div id="d3test">
			<p>First</p>
			<p>Second</p>
			<p>Third</p>
		</div>
		<script type="text/javascript">

//			!function(){
	{
		var dataset = [];

		let starttime = Date.now();
		var pushdataid = setInterval(function(){
			let time = Date.now();
			let voltage = 50 + 50 * Math.sin((time - starttime) / 1000);

			dataset.push({time, voltage});
		}, 10);
	}

	var config = {
		graph: {
			width: 1080,
			height: 720,
		},
		margin: {
			left: 80,
			right: 80,
			top: 80,
			bottom: 80,
		},
		display: {
			keepinterval: 6000,
			renderinterval: 30,
		},
	};

	var svg = d3.select("#graph").append("svg");

	svg.attr("width", config.margin.left + config.graph.width + config.margin.right);
	svg.attr("height", config.margin.top + config.graph.height + config.margin.bottom);

        // Title
        svg.append('text')
        .attr('x', config.margin.left + config.graph.width / 2)
        .attr('y', config.margin.top)
        .attr('text-anchor', 'middle')
//        .style('font-family', 'Helvetica')
        .style('font-size', "2em")
        .text('Scatter Plot');
        
	//{
		let xAxis_group = svg.append("g");
		let xAxis_group_x = config.margin.left;
		let xAxis_group_y = config.margin.top + config.graph.height;

		let xAxis_text = xAxis_group.append("text")
				.attr("x", config.graph.width / 2);

		xAxis_text
		.attr('x', xAxis_group_x + config.graph.width / 2)
		.attr('y', xAxis_group_y)
		.attr('dy', "2em") // to be adjusted
		.attr('text-anchor', 'middle')
		.style('font-family', 'Helvetica')
		.style('font-size', "1em")
		.text('Time');

		let xAxis = xAxis_group.append("g")
		<script type="text/babel">
			!function(){
				var rootdiv = document.getElementById("root");

//				var count = 0;
//				var interval = 1000; // [ms]
//
//				function refresh(){
//					ReactDOM.render(
//						<h1>Hello, world! {count}</h1>,
//						rootdiv
//					);
//				};
//
//				function increment(){
//					count++;
//					refresh();
//					//console.log(`incremented count to ${count}`);
//				};
//
//				refresh();
//				setInterval(increment, interval);
//				var interval = 1000; // [ms]

				class SecondCounter extends React.Component{
					constructor(props){
						super(props);
						this.state = {
							count: 0,
							interval: 1000, // [ms]
						};
					}
					
					componentDidMount(){
						var tag = this;
						tag.state.timerid = setInterval(
							function(){
								tag.setState(
									{
										count: tag.state.count + 1,
									}
								);
							},
							tag.state.interval
						);
					}

					componentWillUnmount(){
						clearInterval(this.state.timerid);
					}

					render(){
						return (
							<h1>{this.state.count} seconds passed.</h1>
						);
					}
				}

				ReactDOM.render(
					<SecondCounter />,
					rootdiv
				);
			}();

		</script>
		<script>
			!function(){
				d3.select("#graph")
				.data([1, 2, 3])
				.enter()
				.append("p");
			}();
		</script>
		<!--
		      Note: this page is a great way to try React but it's not suitable for production.
		      It slowly compiles JSX with Babel in the browser and uses a large development build of React.
		
		      Read this section for a production-ready setup with JSX:
		      https://reactjs.org/docs/add-react-to-a-website.html#add-jsx-to-a-project
		
		      In a larger project, you can use an integrated toolchain that includes JSX instead:
		      https://reactjs.org/docs/create-a-new-react-app.html
		
		      You can also use React without JSX, in which case you can remove Babel:
		      https://reactjs.org/docs/react-without-jsx.html
		    -->
	</body>
</html>
